<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> demo </title>
    <link href="css/global.css" rel="stylesheet">
    <style>
        /*#targetPage{width: 1000px; height: 1000px;}*/
    </style>
</head>

<body>

<div class="Nav">
    <div class="group">
        <div class="group__name">ui</div>
        <div class="group__list">
            <div class="group__item -active" data-path="ui">UI</div>
        </div>
    </div>
    <div class="group">
        <div class="group__name">编码解码</div>
        <div class="group__list">
            <div class="group__item" data-path="base64-encoder">url</div>
            <div class="group__item " data-path="base64-encoder">base64</div>
            <div class="group__item" data-path="base64-encoder">QRCode</div>
        </div>
    </div>
    <div class="group">
        <div class="group__name">校验</div>
        <div class="group__list">
            <div class="group__item" data-path="base64-encoder">JSON</div>
            <div class="group__item" data-path="base64-encoder">RegExp</div>
        </div>
    </div>
</div>

<div class="Main">
    <iframe id="targetPage" src="biz/ui/index.html" frameborder="0"></iframe>
</div>

<!--<script src="http://assets.dwstatic.com/common/js/jquery.js"></script>-->
<script>

    // gobal lib
    var _ = require('lodash')
    var $ = require('jquery')
    var Mustache = require('mustache')
    var multiline = require('multiline')
    var menuJSON = require('./js/menu.json')


//    $('#targetPage').on('load', function(){
//        renderMenu()
//    })

    // Menu render
    renderMenu()
    function renderMenu(){
        var el, data, tpl
        el = $('.Nav')
        data = menuJSON
        tpl = multiline(function(){/*!@preserve
         {{#menu}}
         <div class="group">
             <div class="group__name">{{name}}</div>
             <div class="group__list">
                 {{#items}}
                 <div class="group__item {{#default}}-active{{/default}}" data-path="{{path}}">{{name}}</div>
                 {{/items}}
             </div>
         </div>
         {{/menu}}
         */console.log});
        el.html(Mustache.render(tpl, data))
    }



    // Menu events
    var $menu = $('.Nav'), $targetPage = $('#targetPage');
    $menu.on('click', '[data-path]', function(e){
        $menu.find('[data-path]').removeClass('-active')
        var p = $(this).addClass('-active').data('path')
        $targetPage.attr('src', calcPath(p))
    })
    $targetPage.attr('src', calcPath(getDefaultPage(menuJSON)))

    function calcPath(p){
        return 'biz/'+p+'/index.html'
    }
    function getDefaultPage(menuJSON){
        var arr = []
        _.each(menuJSON.menu, function (v) {
            arr = arr.concat(v.items)
        })
        return _.find(arr, {default:true}).path
    }


</script>

<!-- dev relaod -->
<script>
    var gulp = require('gulp');
    gulp.task('reload', function () {
        if (location) location.reload();
    });

    gulp.watch(['*.html', 'js/**', 'img/**', 'css/**', 'biz/**'], ['reload']);
</script>
</body>

</html>
